{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">ðŸ“Š Tablero de Control</h2>
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center table-striped">
      <thead class="table-primary">
        <tr>
          <th style="width: 40px;">NÂ°</th>
          <th>Eje EstratÃ©gico</th>
          <th>Objetivo EstratÃ©gico</th>
          <th>Indicador</th>
          <th>Meta 2025</th>
          <th>Avance</th>
          <th>Nivel</th>
          <th>AcciÃ³n</th>
          <th>Responsable</th>
          <th>Editar</th>
        </tr>
      </thead>
      <tbody>
        {% for eje, objetivos in agrupado.items %}
          {% with contador=1 %}
            {% for objetivo, items in objetivos.items %}
              {% for item in items %}
              <tr>
                {% if forloop.first %}
                  <td rowspan="{{ items|length }}">{{ forloop.parentloop.counter }}</td>
                  <td rowspan="{{ items|length }}" class="fw-bold bg-light">{{ eje }}</td>
                  <td rowspan="{{ items|length }}" class="align-middle bg-light">{{ objetivo }}</td>
                {% endif %}
                <td class="text-start">{{ item.indicador|default_if_none:'' }}</td>
                <td>{{ item.meta_2025|default_if_none:'' }}</td>
                <td>{{ item.avance|default_if_none:'' }}</td>
                <td>
                  {% if item.nivel == "Bajo" %}
                    <span class="badge bg-danger">Bajo</span>
                  {% elif item.nivel == "Medio" %}
                    <span class="badge bg-warning text-dark">Medio</span>
                  {% elif item.nivel == "Alto" %}
                    <span class="badge bg-success">Alto</span>
                  {% else %}
                    &mdash;
                  {% endif %}
                </td>
                <td>{{ item.accion|default_if_none:'' }}</td>
                <td>{{ item.responsable|default_if_none:'' }}</td>
                <td>
                  {% if es_admin or request.user.perfilusuario.responsable == item.responsable %}
                    <a href="{% url 'editar_avance' item.id %}" class="btn btn-sm btn-outline-primary">Editar</a>
                  {% else %}
                    â€”
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            {% endfor %}
          {% endwith %}
        {% empty %}
          <tr>
            <td colspan="10">No hay datos disponibles.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
